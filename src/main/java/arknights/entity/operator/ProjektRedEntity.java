package arknights.entity.operator;

import arknights.Skill;
import arknights.entity.model.ProjektRedModel;
import arknights.registry.EntityHandler;
import arknights.registry.ItemHandler;
import arknights.registry.SoundHandler;
import net.minecraft.entity.Entity;
import net.minecraft.entity.EntityType;
import net.minecraft.entity.LivingEntity;
import net.minecraft.entity.player.PlayerEntity;
import net.minecraft.inventory.EquipmentSlotType;
import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import net.minecraft.particles.BlockParticleData;
import net.minecraft.particles.IParticleData;
import net.minecraft.particles.ParticleTypes;
import net.minecraft.particles.RedstoneParticleData;
import net.minecraft.potion.EffectInstance;
import net.minecraft.potion.Effects;
import net.minecraft.util.DamageSource;
import net.minecraft.util.math.AxisAlignedBB;
import net.minecraft.util.math.Vec3d;
import net.minecraft.world.World;

import javax.annotation.Nullable;
import java.util.List;
import java.util.Random;

public class ProjektRedEntity extends MeleeOperator {
    public ProjektRedModel model;
    private static Skill skill1 = new Skill(0, 5, 0, Skill.SkillRecoverType.AUTORECOVER);
    public boolean onSpawn=true;

    public ProjektRedEntity(EntityType<? extends ProjektRedEntity> typeIn, World worldIn) {
        super(typeIn, worldIn);
        this.setItemStackToSlot(EquipmentSlotType.MAINHAND, new ItemStack(ItemHandler.PROJEKTRED_KNIFE));
    }

    @Override
    public void registerGoals() {
        super.registerGoals();
    }

    public ProjektRedEntity(World world, Item item){
        super(EntityHandler.PROJEKTRED, world, item);
    }
    /**
     * Returns the Y Offset of this entity.
     */

    protected void registerAttributes() {
        super.registerAttributes();
    }


    public void livingTick() {
        super.livingTick();
        if (onSpawn) {
            Vec3d vec3d = this.getPositionVec();
            List<Entity> list = this.world.getEntitiesWithinAABBExcludingEntity(this, new AxisAlignedBB(vec3d.x - 8, vec3d.y - 2, vec3d.z - 8, vec3d.x + 8, vec3d.y + 2, vec3d.z + 8));
            for (int k2 = 0; k2 < list.size(); ++k2) {
                Entity entity = list.get(k2);
                if (entity instanceof LivingEntity && entity != this.getOwner() && !(entity instanceof OperatorBase)) {
                    ((LivingEntity) entity).addPotionEffect(new EffectInstance(Effects.SLOWNESS, 60, 255));
                    entity.attackEntityFrom(DamageSource.causeMobDamage(this), 10);
                }
            }
            if (!this.world.isRemote) {
                String effectParticle[] = new String[79];
                effectParticle[1] = "...........................................................................................##.........................................................";
                effectParticle[2] = ".....................................................##....................................###........................................................";
                effectParticle[3] = "....................................................###....................................####.......................................................";
                effectParticle[4] = "....................................................###....................................#####......................................................";
                effectParticle[5] = "...................................................####....................................#..###.....................................................";
                effectParticle[6] = "...................................................####....................................#...###....................................................";
                effectParticle[7] = "..................................................#####....................................#....###...................................................";
                effectParticle[8] = ".................................................######...................................##.....##...................................................";
                effectParticle[9] = ".................................................######...................................##.....###..................................................";
                effectParticle[10] = "................................................###..##...................................##..##..###.................................................";
                effectParticle[11] = "...............................................####..##...................................##..##...###................................................";
                effectParticle[12] = "...............................................####..##...................................##..##....##................................................";
                effectParticle[13] = "..............................................####...##...................................##..###...###...............................................";
                effectParticle[14] = ".............................................#####...##...................................##..####...###..............................................";
                effectParticle[15] = ".............................................#####...##...................................##...###....###.............................................";
                effectParticle[16] = "............................................#####....##...................................##...###....###.............................................";
                effectParticle[17] = "............................................#####....##..................................###...###.....###............................................";
                effectParticle[18] = "...........................................#####.....##..................................###...###......###...........................................";
                effectParticle[19] = "..........................................######.....##..................................###...###......####..........................................";
                effectParticle[20] = "..........................................#####......##..................................##....####......###..........................................";
                effectParticle[21] = ".........................................######......##.................................###....####......####.........................................";
                effectParticle[22] = "........................................######.......##.................................###...######......####........................................";
                effectParticle[23] = "........................................######.......###...............................###...#######......####........................................";
                effectParticle[24] = ".......................................######........####.......................###....###...#########.....####.......................................";
                effectParticle[25] = "......................................#######........#####....................######..####...#########.....#####......................................";
                effectParticle[26] = "......................................######.........#######................#############....##########....######.....................................";
                effectParticle[27] = ".....................................#######.........########.....#........######..######....###########....#####.....................................";
                effectParticle[28] = "....................................#######....###...#########....###....########...........########..###....#####....................................";
                effectParticle[29] = "....................................#######..###.....##########....################.........########..........#####...................................";
                effectParticle[30] = "...................................###########.......################################......###########.........#####..................................";
                effectParticle[31] = "...................................#########.........#################################.....#############........####..................................";
                effectParticle[32] = "..................................########.........####################################....###############.......####.................................";
                effectParticle[33] = ".................................#######........######################################....##################.......###................................";
                effectParticle[34] = ".............................................##########################################..######################....####...............................";
                effectParticle[35] = "..........................##..............###############################################################################.............................";
                effectParticle[36] = "........................###...........########..############################################################################..........................";
                effectParticle[37] = ".....................#####.........########.....######################################################..........###############.......................";
                effectParticle[38] = "...................######.......#######........#######################################################...............#############....................";
                effectParticle[39] = "................########.....#######..........#######################################################...####..............###########.................";
                effectParticle[40] = "..............#########...#######.....####...#######################################################...#########..............##########..............";
                effectParticle[41] = "...........#####################....######...######################################################....##############..............########...........";
                effectParticle[42] = "........#################################...#######################################################..#####################.............#######........";
                effectParticle[43] = ".....###################################....######################################################...#########.###############..............####......";
                effectParticle[44] = "..######################################...######################################################...#########.................................#####...";
                effectParticle[45] = ".....###########################################################################################...###########.....................#########.#######..";
                effectParticle[46] = "..........#####################################################################################...###############............################.........";
                effectParticle[47] = "................###############################################################################..#################..........##########................";
                effectParticle[48] = ".......................######################################################################....###################.........###......................";
                effectParticle[49] = ".......................#####################################################################...#######################.......###......................";
                effectParticle[50] = ".....................#####################################################################....################...#######......####....................";
                effectParticle[51] = ".....................####################################################################....##################......#####.....####...................";
                effectParticle[52] = "....................#############################################################################################...............####..................";
                effectParticle[53] = "..................######################################################################################..########................###.................";
                effectParticle[54] = "................#######################################################################################....########.................##................";
                effectParticle[55] = ".............#########################################################################################.......########......####......##...............";
                effectParticle[56] = "...........##########################################################################################.........########......############..............";
                effectParticle[57] = "...................##################################################################################...........#######......###....######............";
                effectParticle[58] = "..................###################################################################################................####......##.....................";
                effectParticle[59] = ".................###################################################################################......##....................###...................";
                effectParticle[60] = "...............#####################################################################################.....#####...................####.................";
                effectParticle[61] = "..............##########################......#####################################################....##########..................####...............";
                effectParticle[62] = ".............########################.........#####################################################...####...#######................#####.............";
                effectParticle[63] = "...........###############....####............###################################################....####.......############..........#####...........";
                effectParticle[64] = "..........############.......###..............#################################################.....####...........#################..#######.........";
                effectParticle[65] = ".........#########..........##................###############################################.....#####...............####################.###........";
                effectParticle[66] = ".......#######.................................###########################################......#######..................#####........................";
                effectParticle[67] = ".......##.......................................######################################.......#########................................................";
                effectParticle[68] = "................................................####################################.......####.......................................................";
                effectParticle[69] = "..................................................################################....#######.........................................................";
                effectParticle[70] = "....................................................###########################.....#######...........................................................";
                effectParticle[71] = "......................................................#######################.....######..............................................................";
                effectParticle[72] = ".........................................................####...###########.....######................................................................";
                effectParticle[73] = "...........................................................###...########....#######..................................................................";
                effectParticle[74] = "...................................................................#######.#######....................................................................";
                effectParticle[75] = ".....................................................................##########.......................................................................";
                effectParticle[76] = "......................................................................#######.........................................................................";
                effectParticle[77] = "........................................................................###...........................................................................";

                double startX = vec3d.x - 75;
                double startY = vec3d.y + 77 / 2;

                for (int y = 1; y <= 77; y++) {
                    for (int x = 1; x <= effectParticle[1].length() - 1; x++) {
                        //System.out.print("x="+x+"y="+y);
                        //System.out.print(effectParticle[y].charAt(x));
                        if (effectParticle[y].charAt(x) == '#') {
                            //System.out.print("yes");
                            this.world.addParticle(new RedstoneParticleData(0F, 0F, 0F, 1F), startX + x * 0.05, startY - y * 0.05, vec3d.z, 0, 0, 0);
                        }
                    }
                }
                this.playSound(SoundHandler.SKILL_WOLFROAR, 1.0F, 1.0F);
            }
            onSpawn=false;
        }
        if(!world.isRemote()) {
            this.tick++;
            if (this.tick % 19 == 2 && !this.isSkill) {
                this.sp++;
            }
            if (this.sp >= skill1.spCost) {
                this.sp = 0;
                this.isSkill = true;
                this.tick = 0;
                this.yell();
            }
        }
    }

    protected void yell(){
        switch (new Random().nextInt(4)) {
            case 0:
                this.playSound(SoundHandler.PROJEKTRED_COMBATING1, 1.0F, 1.0F);
                break;
            case 1:
                this.playSound(SoundHandler.PROJEKTRED_COMBATING2, 1.0F, 1.0F);
                break;
            case 2:
                this.playSound(SoundHandler.PROJEKTRED_COMBATING3, 1.0F, 1.0F);
                break;
            case 3:
                this.playSound(SoundHandler.PROJEKTRED_COMBATING4, 1.0F, 1.0F);
                break;
            default:
                break;
        }
    }

    @Override
    public void setAttackTarget(@Nullable LivingEntity entitylivingbaseIn) {
        super.setAttackTarget(entitylivingbaseIn); //Forge: Moved down to allow event handlers to write data manager values.
    }

}
